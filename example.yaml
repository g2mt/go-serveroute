# run example with `./serveroute -config example.yaml`

domain: localhost
listen:
  http: "127.0.0.1:8080" # required
  # https: "127.0.0.1:8443" # optional
ssl_certificate: /etc/ssl/localhost.crt # optional ssl public key
ssl_certificate_key: /etc/ssl/localhost.key # optional ssl private key
workdir: . # optional, defaults to directory containing this config file

allowlist: [] # optional, if not empty, only allow these IPs/CIDRs (e.g., "1.2.3.4" or "10.0.0.0/24")
blocklist: [] # optional, block these IPs/CIDRs (e.g., "192.168.1.100")

alt_hosts: # optional, if specified and client sends a matching Host header, then proxies requests to this other alt host
  alt_host_1: # forwards request if the Host header is "alt_host_1"
    ssh: # this is an ssh-type forwarding
      host: "alt_host_ssh_1"
      port: 22 # port of ssh connection
      forwards_to: "http://127.0.0.1:80" # opens a tunnel which forwards remote's address (127.0.0.1:80),
      # to a temporary UNIX socket file in local. equivalent to the command
      #   ssh -N -L /tmp/xxxxx.socket:127.0.0.1:80 alt_host_ssh_1
      # serveroute will then forward requests to the socket file, effectively acting as a proxy
      reconnect: true # defaults to true. if true then the ssh process will automatically restart if it is closed

services:
  main:
    subdomain: "" # empty for zero subdomain
    serve_files: ./public # relative to current working dir
    hidden: true # if true, then service will not appear in api list

  py_http_server:
    subdomain: "files" # service lies at files.[domain]
    forwards_to: "http://localhost:8001" # redirects ex: "/abc" to "http://localhost:8001/abc"
    autostart: true # automatically start this service when serveroute starts
    start: ["/usr/bin/python", "-m", "http.server", "-d", "./public", "-b", "127.0.0.1", "8001"]
      # starts the command above when first entering subdomain
    # stop: [...] # optional, runs this command to stop the service
    timeout: 5 # in seconds, if set (>0) then it will timeout if n seconds has passed AFTER the last packet sent to this subdomain

    # NOTE: sets the following HTTP headers on proxy (similar to nginx)
    # proxy_set_header Host $http_host;
    # proxy_set_header X-Real-IP $remote_addr;
    # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # proxy_set_header X-Forwarded-Proto $scheme;
  api: # expose the serveroute api for /start, /stop and /status
    subdomain: "api"
    api: true

